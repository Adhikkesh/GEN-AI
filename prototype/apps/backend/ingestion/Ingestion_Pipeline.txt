┌─────────────────────────────────────────────────────────────┐
│                    USER TRIGGERS INGESTION                   │
│              POST /ingestTrigger (HTTP Function)             │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  1. Publish message to Pub/Sub topic 'run-ingestion'        │
│  2. Return 202 Accepted immediately                          │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│            Pub/Sub triggers ingestionWorker                  │
│              (Cloud Function with long timeout)              │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              FETCH ACTIVE CAREERS (Firestore)                │
│    Users with chosenCareerId → Map<careerId, userCount>     │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              BATCH PROCESSING (Serial Batches)               │
│              Each batch = 5 careers (configurable)           │
└────────────────────┬────────────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
┌───────────────┐         ┌───────────────┐
│  Career 1     │   ...   │  Career 5     │
│  (PARALLEL)   │         │  (PARALLEL)   │
└───────┬───────┘         └───────┬───────┘
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
        ┌────────────────────────┐
        │   PER CAREER PIPELINE   │
        └────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
┌─────────────────┐       ┌─────────────────┐
│   FETCH JOBS    │       │   FETCH NEWS    │
│  (SerpApi +     │       │  (Google News)  │
│   JSearch)      │       │                 │
│  ~40 jobs       │       │  ~10 articles   │
└────────┬────────┘       └────────┬────────┘
         │                         │
         ▼                         ▼
┌─────────────────┐       ┌─────────────────┐
│  PROCESS JOBS   │       │  PROCESS NEWS   │
│  (ALL PARALLEL) │       │  (ALL PARALLEL) │
└────────┬────────┘       └────────┬────────┘
         │                         │
         │ For each job/news:      │
         │ 1. Gemini refinement    │
         │ 2. Gemini embedding     │
         │ 3. Store to BigQuery    │
         │ 4. Store to pgVector    │
         │ (Steps 3+4 parallel)    │
         │                         │
         ▼                         ▼
┌─────────────────┐       ┌─────────────────┐
│  BATCH WRITE    │       │  BATCH WRITE    │
│  to Firestore   │       │  to Firestore   │
│  (career_jobs)  │       │  (career_news)  │
└─────────────────┘       └─────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              NEXT BATCH (if remaining careers)               │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  CLEANUP: Disconnect PostgreSQL, Log final counts           │
└─────────────────────────────────────────────────────────────┘